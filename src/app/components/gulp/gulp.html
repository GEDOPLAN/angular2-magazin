<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #408080; font-style: italic">//Deklaration der verwendeten Zusatzmodule</span>
<span style="color: #008000; font-weight: bold">var</span> gulp <span style="color: #666666">=</span> require(<span style="color: #BA2121">&#39;gulp&#39;</span>);
<span style="color: #008000; font-weight: bold">var</span> util <span style="color: #666666">=</span> require(<span style="color: #BA2121">&#39;gulp-util&#39;</span>);
<span style="color: #008000; font-weight: bold">var</span> SystemBuilder <span style="color: #666666">=</span> require(<span style="color: #BA2121">&#39;systemjs-builder&#39;</span>);
<span style="color: #008000; font-weight: bold">var</span> watch <span style="color: #666666">=</span> require(<span style="color: #BA2121">&#39;gulp-watch&#39;</span>);
<span style="color: #008000; font-weight: bold">var</span> ts <span style="color: #666666">=</span> require(<span style="color: #BA2121">&#39;gulp-typescript&#39;</span>);
<span style="color: #008000; font-weight: bold">var</span> tsConfig <span style="color: #666666">=</span> require(<span style="color: #BA2121">&#39;./tsconfig.json&#39;</span>);
<span style="color: #008000; font-weight: bold">var</span> sourcemaps <span style="color: #666666">=</span> require(<span style="color: #BA2121">&#39;gulp-sourcemaps&#39;</span>);
<span style="color: #008000; font-weight: bold">var</span> connect <span style="color: #666666">=</span> require(<span style="color: #BA2121">&#39;gulp-connect&#39;</span>);
<span style="color: #008000; font-weight: bold">var</span> proxy <span style="color: #666666">=</span> require(<span style="color: #BA2121">&#39;http-proxy-middleware&#39;</span>);
<span style="color: #008000; font-weight: bold">var</span> uglify <span style="color: #666666">=</span> require(<span style="color: #BA2121">&#39;gulp-uglify&#39;</span>);
<span style="color: #008000; font-weight: bold">var</span> useref <span style="color: #666666">=</span> require(<span style="color: #BA2121">&#39;gulp-useref&#39;</span>);
<span style="color: #008000; font-weight: bold">var</span> cssnano <span style="color: #666666">=</span> require(<span style="color: #BA2121">&#39;gulp-cssnano&#39;</span>);
<span style="color: #008000; font-weight: bold">var</span> inlineNg2Template <span style="color: #666666">=</span> require(<span style="color: #BA2121">&#39;gulp-inline-ng2-template&#39;</span>);
<span style="color: #008000; font-weight: bold">var</span> runSequence <span style="color: #666666">=</span> require(<span style="color: #BA2121">&#39;run-sequence&#39;</span>);
<span style="color: #008000; font-weight: bold">var</span> del <span style="color: #666666">=</span> require(<span style="color: #BA2121">&#39;del&#39;</span>);
<span style="color: #008000; font-weight: bold">var</span> maven <span style="color: #666666">=</span> require(<span style="color: #BA2121">&#39;gulp-maven-deploy&#39;</span>);
<span style="color: #008000; font-weight: bold">var</span> war<span style="color: #666666">=</span> require(<span style="color: #BA2121">&#39;gulp-war&#39;</span>);

<span style="color: #008000; font-weight: bold">var</span> tsProject <span style="color: #666666">=</span> ts.createProject(tsConfig.compilerOptions);

<span style="color: #408080; font-style: italic">// Kopiert alle externen JS-Dateien in den Ziel Ordner (dist/vendor)</span>
gulp.task(<span style="color: #BA2121">&#39;copy:deps&#39;</span>, <span style="color: #008000; font-weight: bold">function</span> () {
    <span style="color: #008000; font-weight: bold">return</span> gulp.src([
        <span style="color: #BA2121">&#39;node_modules/jquery/dist/jquery.js&#39;</span>,
        <span style="color: #BA2121">&#39;node_modules/angular2/bundles/angular2-polyfills.js&#39;</span>,
        <span style="color: #BA2121">&#39;node_modules/angular2/bundles/angular2.dev.js&#39;</span>,
        <span style="color: #BA2121">&#39;node_modules/angular2/bundles/http.js&#39;</span>,
        <span style="color: #BA2121">&#39;node_modules/angular2/bundles/router.js&#39;</span>,
        <span style="color: #BA2121">&#39;node_modules/rxjs/bundles/Rx.js&#39;</span>,
        <span style="color: #BA2121">&#39;node_modules/systemjs/dist/system.js&#39;</span>,
        <span style="color: #BA2121">&#39;node_modules/bootstrap/dist/js/bootstrap.js&#39;</span>
    ]).pipe(gulp.dest(<span style="color: #BA2121">&#39;dist/vendor&#39;</span>));
});

<span style="color: #408080; font-style: italic">// Kopiert alle externen CSS-Dateien in den Ziel Ordner (dist/app/assets/css)</span>
gulp.task(<span style="color: #BA2121">&#39;copy:styledeps&#39;</span>, <span style="color: #008000; font-weight: bold">function</span> () {
    gulp.src([
        <span style="color: #BA2121">&#39;node_modules/bootstrap/dist/fonts/*&#39;</span>,
        <span style="color: #BA2121">&#39;node_modules/font-awesome/fonts/*&#39;</span>
    ]).pipe(gulp.dest(<span style="color: #BA2121">&#39;dist/app/assets/fonts/&#39;</span>));

    <span style="color: #008000; font-weight: bold">return</span> gulp.src([
        <span style="color: #BA2121">&#39;node_modules/bootstrap/dist/css/bootstrap.css&#39;</span>,
        <span style="color: #BA2121">&#39;node_modules/font-awesome/css/font-awesome.css&#39;</span>
    ]).pipe(gulp.dest(<span style="color: #BA2121">&#39;dist/app/assets/css&#39;</span>));
});

<span style="color: #408080; font-style: italic">// Kopiert unsere statischen Dateien in den Ziel Ordner (dist)</span>
gulp.task(<span style="color: #BA2121">&#39;copy:src&#39;</span>, <span style="color: #008000; font-weight: bold">function</span> () {
    <span style="color: #008000; font-weight: bold">return</span> gulp.src([
        <span style="color: #BA2121">&#39;src/boot.js&#39;</span>,
        <span style="color: #BA2121">&#39;src/index.html&#39;</span>,
        <span style="color: #BA2121">&#39;src/**/*.html&#39;</span>,
        <span style="color: #BA2121">&#39;src/**/*.css&#39;</span>,
        <span style="color: #BA2121">&#39;src/**/*.png&#39;</span>
    ])
            .pipe(gulp.dest(<span style="color: #BA2121">&#39;dist&#39;</span>))
            .pipe(connect.reload());
});

<span style="color: #408080; font-style: italic">// Unser extrem simples &quot;Hello World&quot; Beispiel</span>
gulp.task(<span style="color: #BA2121">&#39;copy:helloworld&#39;</span>, <span style="color: #008000; font-weight: bold">function</span> () {
    <span style="color: #008000; font-weight: bold">return</span> gulp.src([
        <span style="color: #BA2121">&#39;src/helloworld/**/*&#39;</span>
    ])
            .pipe(gulp.dest(<span style="color: #BA2121">&#39;dist/helloworld&#39;</span>))
            .pipe(connect.reload());
});



<span style="color: #408080; font-style: italic">// Zielverzeichnis löschen</span>
gulp.task(<span style="color: #BA2121">&#39;clean&#39;</span>, <span style="color: #008000; font-weight: bold">function</span> (cb) {
    del(<span style="color: #BA2121">&#39;dist&#39;</span>);
});

<span style="color: #408080; font-style: italic">// Kompiliet alle TypeScript Dateien ins Zielverzeichnis</span>
gulp.task(<span style="color: #BA2121">&#39;compile:app&#39;</span>, <span style="color: #008000; font-weight: bold">function</span> () {
    <span style="color: #008000; font-weight: bold">return</span> gulp.src(<span style="color: #BA2121">&#39;src/**/*.ts&#39;</span>)
            .pipe(sourcemaps.init())
            .pipe(ts(tsProject))
            .pipe(sourcemaps.write())
            .pipe(gulp.dest(<span style="color: #BA2121">&#39;./dist&#39;</span>))
            .pipe(connect.reload());
});

<span style="color: #408080; font-style: italic">// erzeugt aus den HTML/CSS Dateien der Komponenten Inline-Elemente</span>
<span style="color: #408080; font-style: italic">// = aus templateUrl: &#39;some/url&#39; wird template: &#39;&lt;html&gt;....&#39;</span>
<span style="color: #408080; font-style: italic">// = Minimierung der Requests</span>
gulp.task(<span style="color: #BA2121">&#39;build:inline&#39;</span>, <span style="color: #008000; font-weight: bold">function</span> () {
    <span style="color: #008000; font-weight: bold">return</span> gulp.src(<span style="color: #BA2121">&#39;src/**/*.ts&#39;</span>)
            .pipe(inlineNg2Template({
                base<span style="color: #666666">:</span> <span style="color: #BA2121">&#39;/src&#39;</span>,
                target<span style="color: #666666">:</span> <span style="color: #BA2121">&#39;es5&#39;</span>
            }))
            .pipe(ts(tsProject))
            .pipe(gulp.dest(<span style="color: #BA2121">&#39;dist&#39;</span>));
});

<span style="color: #408080; font-style: italic">// Minimierung der Dateigrößen von JavaScript Dateien</span>
gulp.task(<span style="color: #BA2121">&#39;build:uglify&#39;</span>, <span style="color: #008000; font-weight: bold">function</span> () {
    <span style="color: #008000; font-weight: bold">return</span> gulp.src([<span style="color: #BA2121">&#39;dist/*.js&#39;</span>, <span style="color: #BA2121">&#39;dist/**/*.js&#39;</span>])
            .pipe(uglify())
            .pipe(gulp.dest(<span style="color: #BA2121">&#39;./dist&#39;</span>));
});

<span style="color: #408080; font-style: italic">// Minimierung der Dateigrößen von CSS Dateien</span>
gulp.task(<span style="color: #BA2121">&#39;build:cssnano&#39;</span>, <span style="color: #008000; font-weight: bold">function</span> () {
    <span style="color: #008000; font-weight: bold">return</span> gulp.src(<span style="color: #BA2121">&#39;dist/**/*.css&#39;</span>)
            .pipe(cssnano())
            .pipe(gulp.dest(<span style="color: #BA2121">&#39;./dist&#39;</span>));
});

<span style="color: #408080; font-style: italic">// Ersetzt die Script/CSS Referenzen in der HTML Datei mit unseren minimierten Versionen</span>
<span style="color: #408080; font-style: italic">// Dazu existieren in der index.html speziell ausgezeichnete Bereiche</span>
gulp.task(<span style="color: #BA2121">&#39;build:useref&#39;</span>, <span style="color: #008000; font-weight: bold">function</span> () {
    <span style="color: #008000; font-weight: bold">return</span> gulp.src(<span style="color: #BA2121">&#39;dist/index.html&#39;</span>)
            .pipe(useref())
            .pipe(gulp.dest(<span style="color: #BA2121">&#39;dist&#39;</span>));
});

<span style="color: #408080; font-style: italic">// Entfernen der nicht minimierten Versionen und Komponenten Dateien </span>
gulp.task(<span style="color: #BA2121">&#39;build:clean&#39;</span>, <span style="color: #008000; font-weight: bold">function</span> () {
    del([<span style="color: #BA2121">&#39;dist/vendor&#39;</span>, <span style="color: #BA2121">&#39;dist/app/assets/css&#39;</span>, <span style="color: #BA2121">&#39;dist/app/components/**/*.html&#39;</span>, <span style="color: #BA2121">&#39;dist/app/components/**/*.css&#39;</span>]);
});

<span style="color: #408080; font-style: italic">// generriert eine web.xml für unser Angular-WAR</span>
gulp.task(<span style="color: #BA2121">&#39;build:webxml&#39;</span>, <span style="color: #008000; font-weight: bold">function</span> () {
    <span style="color: #008000; font-weight: bold">return</span> gulp.src(<span style="color: #BA2121">&#39;./dist&#39;</span>)
        .pipe(war({
            welcome<span style="color: #666666">:</span> <span style="color: #BA2121">&#39;index.html&#39;</span>,
            displayName<span style="color: #666666">:</span> <span style="color: #BA2121">&#39;angular2-magazin&#39;</span>,
            webappExtras<span style="color: #666666">:</span> [
                <span style="color: #BA2121">&#39;&lt;error-page&gt;&lt;error-code&gt;404&lt;/error-code&gt;&lt;location&gt;/index.html&lt;/location&gt;&lt;/error-page&gt;&#39;</span>
            ]
        }))
        .pipe(gulp.dest(<span style="color: #BA2121">&quot;./dist&quot;</span>));
});



<span style="color: #408080; font-style: italic">// Erzeugt aus dem Zielverzeichnis ein Maven-Artefakt und installiert dies im lokalen Repository</span>
gulp.task(<span style="color: #BA2121">&#39;build:deploy-local&#39;</span>, <span style="color: #008000; font-weight: bold">function</span> () {
    gulp.src(<span style="color: #BA2121">&#39;dist&#39;</span>)
            .pipe(maven.install({
                <span style="color: #BA2121">&#39;config&#39;</span><span style="color: #666666">:</span> {
                    <span style="color: #BA2121">&#39;groupId&#39;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&#39;de.gedoplan&#39;</span>,
                    <span style="color: #BA2121">&#39;type&#39;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&#39;war&#39;</span>,
                    <span style="color: #BA2121">&#39;artifactId&#39;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&#39;angular2-magazin&#39;</span>,
                    <span style="color: #BA2121">&#39;finalName&#39;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&#39;angular2-magazin&#39;</span>
                }
            }));
});


<span style="color: #408080; font-style: italic">// Default Task = Kompilieren und Kopieren der Dateien + Webserver starten</span>
gulp.task(<span style="color: #BA2121">&#39;default&#39;</span>, [<span style="color: #BA2121">&#39;server&#39;</span>], <span style="color: #008000; font-weight: bold">function</span> () {
    gulp.watch([<span style="color: #BA2121">&#39;src/**/*.ts&#39;</span>], [<span style="color: #BA2121">&#39;compile:app&#39;</span>]);
    gulp.watch([<span style="color: #BA2121">&#39;src/**/.js&#39;</span>, <span style="color: #BA2121">&#39;src/**/*.html&#39;</span>, <span style="color: #BA2121">&#39;src/**/*.css&#39;</span>], [<span style="color: #BA2121">&#39;copy:src&#39;</span>]);
});

gulp.task(<span style="color: #BA2121">&#39;server&#39;</span>, [<span style="color: #BA2121">&#39;copy:deps&#39;</span>, <span style="color: #BA2121">&#39;copy:styledeps&#39;</span>, <span style="color: #BA2121">&#39;copy:src&#39;</span>, <span style="color: #BA2121">&#39;compile:app&#39;</span>], <span style="color: #008000; font-weight: bold">function</span> () {
    connect.server({
        root<span style="color: #666666">:</span> <span style="color: #BA2121">&#39;dist&#39;</span>,
        livereload<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">true</span>,
        port<span style="color: #666666">:</span> <span style="color: #666666">3000</span>,
        fallback<span style="color: #666666">:</span> <span style="color: #BA2121">&#39;dist/index.html&#39;</span>,
        middleware<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">function</span> (connect, opt) {
            <span style="color: #008000; font-weight: bold">return</span> [
                proxy(<span style="color: #BA2121">&#39;/webresources&#39;</span>, {
                    target<span style="color: #666666">:</span> <span style="color: #BA2121">&#39;http://localhost:8080&#39;</span>
                })
            ];
        }
    });
});

<span style="color: #408080; font-style: italic">// Produktions-Artefakt erzeugen: zusätzlich zu den Default-Tasks werden Code Optimierungen durchgeführt</span>
gulp.task(<span style="color: #BA2121">&#39;package&#39;</span>, <span style="color: #008000; font-weight: bold">function</span> () {
    runSequence(<span style="color: #BA2121">&#39;copy:deps&#39;</span>, <span style="color: #BA2121">&#39;copy:styledeps&#39;</span>, <span style="color: #BA2121">&#39;copy:src&#39;</span>, <span style="color: #BA2121">&#39;build:inline&#39;</span>, <span style="color: #BA2121">&#39;build:uglify&#39;</span>, <span style="color: #BA2121">&#39;build:cssnano&#39;</span>, <span style="color: #BA2121">&#39;build:useref&#39;</span>, <span style="color: #BA2121">&#39;build:clean&#39;</span>, <span style="color: #BA2121">&#39;build:webxml&#39;</span>,  <span style="color: #BA2121">&#39;build:deploy-local&#39;</span>);
});
</pre></div>
